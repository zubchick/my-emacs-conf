(defun sql-font-lock-keywords-builder (face boundaries &rest keywords)
    "Generation of regexp matching any one of KEYWORDS."

    (let ((bdy (or boundaries '("\\b" . "\\b")))
	  kwd)

    (setq kwd keywords)

    (cons (concat (car bdy)
	      (regexp-opt kwd t)
	      (cdr bdy))
	  face)))

(defvar sql-mode-yql-font-lock-keywords
  (eval-when-compile
    (list
     '("\"[^\"]*\"" . font-lock-string-face)
     '("'[^']*'" . font-lock-string-face)
;;   '("@@[\0-\377[:nonascii:]]*?@@" . font-lock-string-face)
     '("@@\\(.*?\n\\)*?.*?@@" . font-lock-string-face)
     '("\$[a-z0-9_]*" . font-lock-variable-name-face)
     '("[a-zA-Z\.]*`[^`]+`" . font-lock-type-face)
     '("[a-zA-Z0-9_]*::[a-zA-Z0-9_]*" . font-lock-function-name-face)

     (sql-font-lock-keywords-builder 'font-constant-face nil "true" "false" "TRUE" "FALSE")
     (sql-font-lock-keywords-builder 'font-lock-type-face nil "bool" "date" "datetime" "decimal" "double" "float" "int16" "int32" "int64" "int8" "interval" "json" "string" "timestamp" "tzdate" "tzdatetime" "tztimestamp" "uint16" "uint32" "uint64" "uint8" "utf8" "uuid" "yson")
     (sql-font-lock-keywords-builder 'font-lock-keyword-face nil "$row" "$Row" "$ROW" "$rows" "$Rows" "$ROWS" "action" "Action" "ACTION" "all" "All" "ALL" "and" "And" "AND" "as" "As" "AS" "asc" "Asc" "ASC" "assume" "Assume" "ASSUME" "begin" "Begin" "BEGIN" "bernoulli" "Bernoulli" "BERNOULLI" "between" "Between" "BETWEEN" "by" "By" "BY" "case" "Case" "CASE" "columns" "Columns" "COLUMNS" "commit" "Commit" "COMMIT" "create" "Create" "CREATE" "cross" "Cross" "CROSS" "cube" "Cube" "CUBE" "declare" "Declare" "DECLARE" "define" "Define" "DEFINE" "delete" "Delete" "DELETE" "desc" "Desc" "DESC" "dict" "Dict" "DICT" "distinct" "Distinct" "DISTINCT" "do" "Do" "DO" "drop" "Drop" "DROP" "else" "Else" "ELSE" "empty_action" "Empty_Action" "EMPTY_ACTION" "end" "End" "END" "erase" "Erase" "ERASE" "evaluate" "Evaluate" "EVALUATE" "exclusion" "Exclusion" "EXCLUSION" "exists" "Exists" "EXISTS" "export" "Export" "EXPORT" "flatten" "Flatten" "FLATTEN" "for" "For" "FOR" "from" "From" "FROM" "full" "Full" "FULL" "group" "Group" "GROUP" "grouping" "Grouping" "GROUPING" "having" "Having" "HAVING" "if" "If" "IF" "ignore" "Ignore" "IGNORE" "ilike" "Ilike" "ILIKE" "import" "Import" "IMPORT" "in" "In" "IN" "inner" "Inner" "INNER" "insert" "Insert" "INSERT" "into" "Into" "INTO" "is" "Is" "IS" "join" "Join" "JOIN" "left" "Left" "LEFT" "like" "Like" "LIKE" "limit" "Limit" "LIMIT" "list" "List" "LIST" "match" "Match" "MATCH" "not" "Not" "NOT" "null" "Null" "NULL" "nulls" "Nulls" "NULLS" "offset" "Offset" "OFFSET" "on" "On" "ON" "only" "Only" "ONLY" "optional" "Optional" "OPTIONAL" "or" "Or" "OR" "order" "Order" "ORDER" "over" "Over" "OVER" "partition" "Partition" "PARTITION" "pragma" "Pragma" "PRAGMA" "presort" "Presort" "PRESORT" "process" "Process" "PROCESS" "reduce" "Reduce" "REDUCE" "regexp" "Regexp" "REGEXP" "repeatable" "Repeatable" "REPEATABLE" "replace" "Replace" "REPLACE" "respect" "Respect" "RESPECT" "result" "Result" "RESULT" "return" "Return" "RETURN" "right" "Right" "RIGHT" "rlike" "Rlike" "RLIKE" "rollup" "Rollup" "ROLLUP" "sample" "Sample" "SAMPLE" "schema" "Schema" "SCHEMA" "select" "Select" "SELECT" "semi" "Semi" "SEMI" "set" "Set" "SET" "sets" "Sets" "SETS" "subquery" "Subquery" "SUBQUERY" "table" "Table" "TABLE" "tablesample" "Tablesample" "TABLESAMPLE" "then" "Then" "THEN" "truncate" "Truncate" "TRUNCATE" "union" "Union" "UNION" "update" "Update" "UPDATE" "upsert" "Upsert" "UPSERT" "use" "Use" "USE" "using" "Using" "USING" "values" "Values" "VALUES" "view" "View" "VIEW" "when" "When" "WHEN" "where" "Where" "WHERE" "window" "Window" "WINDOW" "with" "With" "WITH" "without" "Without" "WITHOUT" "xor" "Xor" "XOR")
     (sql-font-lock-keywords-builder 'font-lock-builtin-face nil "abs" "Abs" "ABS" "aggregate_by" "Aggregate_By" "AGGREGATE_BY" "aggregate_list" "Aggregate_List" "AGGREGATE_LIST" "aggregate_list_distinct" "Aggregate_List_Distinct" "AGGREGATE_LIST_DISTINCT" "aggregation_factory" "Aggregation_Factory" "AGGREGATION_FACTORY" "agg_list" "Agg_List" "AGG_LIST" "agg_list_distinct" "Agg_List_Distinct" "AGG_LIST_DISTINCT" "as_table" "As_Table" "AS_TABLE" "avg" "Avg" "AVG" "avg_if" "Avg_If" "AVG_IF" "adaptivedistancehistogram" "Adaptivedistancehistogram" "ADAPTIVEDISTANCEHISTOGRAM" "adaptivewardhistogram" "Adaptivewardhistogram" "ADAPTIVEWARDHISTOGRAM" "adaptiveweighthistogram" "Adaptiveweighthistogram" "ADAPTIVEWEIGHTHISTOGRAM" "addmember" "Addmember" "ADDMEMBER" "addtimezone" "Addtimezone" "ADDTIMEZONE" "asatom" "Asatom" "ASATOM" "asdict" "Asdict" "ASDICT" "asdictstrict" "Asdictstrict" "ASDICTSTRICT" "aslist" "Aslist" "ASLIST" "asliststrict" "Asliststrict" "ASLISTSTRICT" "asstruct" "Asstruct" "ASSTRUCT" "astagged" "Astagged" "ASTAGGED" "astuple" "Astuple" "ASTUPLE" "atomcode" "Atomcode" "ATOMCODE" "bitcast" "Bitcast" "BITCAST" "bit_and" "Bit_And" "BIT_AND" "bit_or" "Bit_Or" "BIT_OR" "bit_xor" "Bit_Xor" "BIT_XOR" "bool_and" "Bool_And" "BOOL_AND" "bool_or" "Bool_Or" "BOOL_OR" "bottom" "Bottom" "BOTTOM" "bottom_by" "Bottom_By" "BOTTOM_BY" "blockwardhistogram" "Blockwardhistogram" "BLOCKWARDHISTOGRAM" "blockweighthistogram" "Blockweighthistogram" "BLOCKWEIGHTHISTOGRAM" "cast" "Cast" "CAST" "coalesce" "Coalesce" "COALESCE" "concat" "Concat" "CONCAT" "concat_strict" "Concat_Strict" "CONCAT_STRICT" "correlation" "Correlation" "CORRELATION" "count" "Count" "COUNT" "count_if" "Count_If" "COUNT_IF" "covariance" "Covariance" "COVARIANCE" "covariance_population" "Covariance_Population" "COVARIANCE_POPULATION" "covariance_sample" "Covariance_Sample" "COVARIANCE_SAMPLE" "callableargument" "Callableargument" "CALLABLEARGUMENT" "callableargumenttype" "Callableargumenttype" "CALLABLEARGUMENTTYPE" "callableresulttype" "Callableresulttype" "CALLABLERESULTTYPE" "callabletype" "Callabletype" "CALLABLETYPE" "callabletypecomponents" "Callabletypecomponents" "CALLABLETYPECOMPONENTS" "callabletypehandle" "Callabletypehandle" "CALLABLETYPEHANDLE" "combinemembers" "Combinemembers" "COMBINEMEMBERS" "countdistinctestimate" "Countdistinctestimate" "COUNTDISTINCTESTIMATE" "currentauthenticateduser" "Currentauthenticateduser" "CURRENTAUTHENTICATEDUSER" "currentoperationid" "Currentoperationid" "CURRENTOPERATIONID" "currentoperationsharedid" "Currentoperationsharedid" "CURRENTOPERATIONSHAREDID" "currentutcdate" "Currentutcdate" "CURRENTUTCDATE" "currentutcdatetime" "Currentutcdatetime" "CURRENTUTCDATETIME" "currentutctimestamp" "Currentutctimestamp" "CURRENTUTCTIMESTAMP" "dense_rank" "Dense_Rank" "DENSE_RANK" "datatype" "Datatype" "DATATYPE" "datatypecomponents" "Datatypecomponents" "DATATYPECOMPONENTS" "datatypehandle" "Datatypehandle" "DATATYPEHANDLE" "dictaggregate" "Dictaggregate" "DICTAGGREGATE" "dictcontains" "Dictcontains" "DICTCONTAINS" "dictcreate" "Dictcreate" "DICTCREATE" "dicthasitems" "Dicthasitems" "DICTHASITEMS" "dictitems" "Dictitems" "DICTITEMS" "dictkeytype" "Dictkeytype" "DICTKEYTYPE" "dictkeys" "Dictkeys" "DICTKEYS" "dictlength" "Dictlength" "DICTLENGTH" "dictlookup" "Dictlookup" "DICTLOOKUP" "dictpayloadtype" "Dictpayloadtype" "DICTPAYLOADTYPE" "dictpayloads" "Dictpayloads" "DICTPAYLOADS" "dicttype" "Dicttype" "DICTTYPE" "dicttypecomponents" "Dicttypecomponents" "DICTTYPECOMPONENTS" "dicttypehandle" "Dicttypehandle" "DICTTYPEHANDLE" "each" "Each" "EACH" "each_strict" "Each_Strict" "EACH_STRICT" "ensure" "Ensure" "ENSURE" "ensureconvertibleto" "Ensureconvertibleto" "ENSURECONVERTIBLETO" "ensuretype" "Ensuretype" "ENSURETYPE" "enum" "Enum" "ENUM" "evaluateatom" "Evaluateatom" "EVALUATEATOM" "evaluatecode" "Evaluatecode" "EVALUATECODE" "evaluateexpr" "Evaluateexpr" "EVALUATEEXPR" "expandstruct" "Expandstruct" "EXPANDSTRUCT" "filter" "Filter" "FILTER" "filter_strict" "Filter_Strict" "FILTER_STRICT" "first_value" "First_Value" "FIRST_VALUE" "folder" "Folder" "FOLDER" "filecontent" "Filecontent" "FILECONTENT" "filepath" "Filepath" "FILEPATH" "flattenmembers" "Flattenmembers" "FLATTENMEMBERS" "forceremovemember" "Forceremovemember" "FORCEREMOVEMEMBER" "formatcode" "Formatcode" "FORMATCODE" "formattype" "Formattype" "FORMATTYPE" "frombytes" "Frombytes" "FROMBYTES" "funccode" "Funccode" "FUNCCODE" "greatest" "Greatest" "GREATEST" "grouping" "Grouping" "GROUPING" "generictype" "Generictype" "GENERICTYPE" "histogram" "Histogram" "HISTOGRAM" "hll" "Hll" "HLL" "hyperloglog" "Hyperloglog" "HYPERLOGLOG" "if" "If" "IF" "if_strict" "If_Strict" "IF_STRICT" "instanceof" "Instanceof" "INSTANCEOF" "just" "Just" "JUST" "lag" "Lag" "LAG" "last_value" "Last_Value" "LAST_VALUE" "lead" "Lead" "LEAD" "least" "Least" "LEAST" "len" "Len" "LEN" "length" "Length" "LENGTH" "like" "Like" "LIKE" "likely" "Likely" "LIKELY" "like_strict" "Like_Strict" "LIKE_STRICT" "lambdacode" "Lambdacode" "LAMBDACODE" "linearhistogram" "Linearhistogram" "LINEARHISTOGRAM" "listaggregate" "Listaggregate" "LISTAGGREGATE" "listall" "Listall" "LISTALL" "listany" "Listany" "LISTANY" "listavg" "Listavg" "LISTAVG" "listcode" "Listcode" "LISTCODE" "listcollect" "Listcollect" "LISTCOLLECT" "listconcat" "Listconcat" "LISTCONCAT" "listcreate" "Listcreate" "LISTCREATE" "listdistinct" "Listdistinct" "LISTDISTINCT" "listenumerate" "Listenumerate" "LISTENUMERATE" "listextend" "Listextend" "LISTEXTEND" "listextract" "Listextract" "LISTEXTRACT" "listfilter" "Listfilter" "LISTFILTER" "listflatmap" "Listflatmap" "LISTFLATMAP" "listfromrange" "Listfromrange" "LISTFROMRANGE" "listhas" "Listhas" "LISTHAS" "listhasitems" "Listhasitems" "LISTHASITEMS" "listhead" "Listhead" "LISTHEAD" "listindexof" "Listindexof" "LISTINDEXOF" "listitemtype" "Listitemtype" "LISTITEMTYPE" "listlast" "Listlast" "LISTLAST" "listlength" "Listlength" "LISTLENGTH" "listmap" "Listmap" "LISTMAP" "listmax" "Listmax" "LISTMAX" "listmin" "Listmin" "LISTMIN" "listreplicate" "Listreplicate" "LISTREPLICATE" "listreverse" "Listreverse" "LISTREVERSE" "listskip" "Listskip" "LISTSKIP" "listskipwhile" "Listskipwhile" "LISTSKIPWHILE" "listskipwhileinclusive" "Listskipwhileinclusive" "LISTSKIPWHILEINCLUSIVE" "listsort" "Listsort" "LISTSORT" "listsortasc" "Listsortasc" "LISTSORTASC" "listsortdesc" "Listsortdesc" "LISTSORTDESC" "listsum" "Listsum" "LISTSUM" "listtake" "Listtake" "LISTTAKE" "listtakewhile" "Listtakewhile" "LISTTAKEWHILE" "listtakewhileinclusive" "Listtakewhileinclusive" "LISTTAKEWHILEINCLUSIVE" "listtype" "Listtype" "LISTTYPE" "listtypehandle" "Listtypehandle" "LISTTYPEHANDLE" "listunionall" "Listunionall" "LISTUNIONALL" "listuniq" "Listuniq" "LISTUNIQ" "listzip" "Listzip" "LISTZIP" "listzipall" "Listzipall" "LISTZIPALL" "loghistogram" "Loghistogram" "LOGHISTOGRAM" "logarithmichistogram" "Logarithmichistogram" "LOGARITHMICHISTOGRAM" "max" "Max" "MAX" "max_by" "Max_By" "MAX_BY" "max_of" "Max_Of" "MAX_OF" "median" "Median" "MEDIAN" "min" "Min" "MIN" "min_by" "Min_By" "MIN_BY" "min_of" "Min_Of" "MIN_OF" "mode" "Mode" "MODE" "multi_aggregate_by" "Multi_Aggregate_By" "MULTI_AGGREGATE_BY" "nanvl" "Nanvl" "NANVL" "nvl" "Nvl" "NVL" "nothing" "Nothing" "NOTHING" "nulltype" "Nulltype" "NULLTYPE" "nulltypehandle" "Nulltypehandle" "NULLTYPEHANDLE" "optionalitemtype" "Optionalitemtype" "OPTIONALITEMTYPE" "optionaltype" "Optionaltype" "OPTIONALTYPE" "optionaltypehandle" "Optionaltypehandle" "OPTIONALTYPEHANDLE" "percentile" "Percentile" "PERCENTILE" "parsefile" "Parsefile" "PARSEFILE" "parsetype" "Parsetype" "PARSETYPE" "parsetypehandle" "Parsetypehandle" "PARSETYPEHANDLE" "pickle" "Pickle" "PICKLE" "quotecode" "Quotecode" "QUOTECODE" "range" "Range" "RANGE" "range_strict" "Range_Strict" "RANGE_STRICT" "rank" "Rank" "RANK" "regexp" "Regexp" "REGEXP" "regexp_strict" "Regexp_Strict" "REGEXP_STRICT" "row_number" "Row_Number" "ROW_NUMBER" "random" "Random" "RANDOM" "randomnumber" "Randomnumber" "RANDOMNUMBER" "randomuuid" "Randomuuid" "RANDOMUUID" "removemember" "Removemember" "REMOVEMEMBER" "removetimezone" "Removetimezone" "REMOVETIMEZONE" "replacemember" "Replacemember" "REPLACEMEMBER" "reprcode" "Reprcode" "REPRCODE" "resourcetype" "Resourcetype" "RESOURCETYPE" "resourcetypehandle" "Resourcetypehandle" "RESOURCETYPEHANDLE" "resourcetypetag" "Resourcetypetag" "RESOURCETYPETAG" "some" "Some" "SOME" "stddev" "Stddev" "STDDEV" "stddev_population" "Stddev_Population" "STDDEV_POPULATION" "stddev_sample" "Stddev_Sample" "STDDEV_SAMPLE" "substring" "Substring" "SUBSTRING" "sum" "Sum" "SUM" "sum_if" "Sum_If" "SUM_IF" "setdifference" "Setdifference" "SETDIFFERENCE" "setincludes" "Setincludes" "SETINCLUDES" "setintersection" "Setintersection" "SETINTERSECTION" "setisdisjoint" "Setisdisjoint" "SETISDISJOINT" "setsymmetricdifference" "Setsymmetricdifference" "SETSYMMETRICDIFFERENCE" "setunion" "Setunion" "SETUNION" "staticmap" "Staticmap" "STATICMAP" "staticpickle" "Staticpickle" "STATICPICKLE" "streamitemtype" "Streamitemtype" "STREAMITEMTYPE" "streamtype" "Streamtype" "STREAMTYPE" "streamtypehandle" "Streamtypehandle" "STREAMTYPEHANDLE" "structmembertype" "Structmembertype" "STRUCTMEMBERTYPE" "structtypecomponents" "Structtypecomponents" "STRUCTTYPECOMPONENTS" "structtypehandle" "Structtypehandle" "STRUCTTYPEHANDLE" "top" "Top" "TOP" "topfreq" "Topfreq" "TOPFREQ" "top_by" "Top_By" "TOP_BY" "tablename" "Tablename" "TABLENAME" "tablepath" "Tablepath" "TABLEPATH" "tablerecordindex" "Tablerecordindex" "TABLERECORDINDEX" "tablerow" "Tablerow" "TABLEROW" "taggedtype" "Taggedtype" "TAGGEDTYPE" "taggedtypecomponents" "Taggedtypecomponents" "TAGGEDTYPECOMPONENTS" "taggedtypehandle" "Taggedtypehandle" "TAGGEDTYPEHANDLE" "tobytes" "Tobytes" "TOBYTES" "todict" "Todict" "TODICT" "tomultidict" "Tomultidict" "TOMULTIDICT" "toset" "Toset" "TOSET" "tosorteddict" "Tosorteddict" "TOSORTEDDICT" "tosortedmultidict" "Tosortedmultidict" "TOSORTEDMULTIDICT" "trymember" "Trymember" "TRYMEMBER" "tupleelementtype" "Tupleelementtype" "TUPLEELEMENTTYPE" "tupletype" "Tupletype" "TUPLETYPE" "tupletypecomponents" "Tupletypecomponents" "TUPLETYPECOMPONENTS" "tupletypehandle" "Tupletypehandle" "TUPLETYPEHANDLE" "typehandle" "Typehandle" "TYPEHANDLE" "typekind" "Typekind" "TYPEKIND" "typeof" "Typeof" "TYPEOF" "udaf" "Udaf" "UDAF" "unittype" "Unittype" "UNITTYPE" "unpickle" "Unpickle" "UNPICKLE" "untag" "Untag" "UNTAG" "unwrap" "Unwrap" "UNWRAP" "variance" "Variance" "VARIANCE" "variance_population" "Variance_Population" "VARIANCE_POPULATION" "variance_sample" "Variance_Sample" "VARIANCE_SAMPLE" "variant" "Variant" "VARIANT" "varianttype" "Varianttype" "VARIANTTYPE" "varianttypehandle" "Varianttypehandle" "VARIANTTYPEHANDLE" "variantunderlyingtype" "Variantunderlyingtype" "VARIANTUNDERLYINGTYPE" "voidtype" "Voidtype" "VOIDTYPE" "voidtypehandle" "Voidtypehandle" "VOIDTYPEHANDLE" "way" "Way" "WAY" "worldcode" "Worldcode" "WORLDCODE")
    ))

  "YQL keywords used by font-lock.")

(define-derived-mode yql-mode sql-mode
  "YQL mode"
  "Basic YQL mode derived from SQL mode"

  (setq font-lock-defaults '((sql-mode-yql-font-lock-keywords)))
  (setq font-lock-multiline t)
)

(add-to-list 'auto-mode-alist '("\\.sql\\'" . yql-mode))
;; comment out the previous line to skip enabling YQL mode by default for .sql files

(provide 'yql-mode)

